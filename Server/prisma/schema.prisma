generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// ... keep your datasource and generator blocks ...

enum Role {
  EMPLOYER
  WORKER
}

enum TaskStatus {
  OPEN
  ASSIGNED
  APPLIED
  COMPLETED
  CANCELED
}

model User {
  id           String    @id @default(uuid())
  email        String    @unique
  passwordHash String
  profile      Profile?
  tasks        Task[]    @relation("UserTasks")
  offers       Offer[]
  messages     Message[]
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  @@map("users")
}

model Profile {
  id        String   @id @default(uuid())
  userId    String   @unique
  name      String?
  role      Role
  avatarUrl String?
  user      User     @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("profiles")
}

model Task {
  id          Int     @id @default(autoincrement())
  authorId    String
  title       String
  description String
  budget      Decimal @db.Decimal(10, 2)
  location    String
  address     String?

  // Relation to Category
  categoryId Int // Foreign key
  category   Category @relation(fields: [categoryId], references: [id])

  startTask DateTime?
  endTask   DateTime?
  status    TaskStatus @default(OPEN)

  // Link to the specific winning offer if needed
  assignedOfferId Int? @unique
  offer_id        Int?

  isPayed   Boolean  @default(false)
  offers    Offer[]
  author    User     @relation("UserTasks", fields: [authorId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("tasks")
}

model Category {
  id        Int      @id @default(autoincrement())
  name      String   @unique // Renamed from 'category' for clarity
  icon      String?
  tasks     Task[]
  createdAt DateTime @default(now())

  @@map("categories")
}

// ... Keep Offer, Conversation, and Message as they were ...

model Offer {
  id         Int      @id @default(autoincrement())
  taskId     Int
  userId     String
  amount     Decimal  @db.Decimal(10, 2)
  isAssigned Boolean  @default(false)
  task       Task     @relation(fields: [taskId], references: [id])
  user       User     @relation(fields: [userId], references: [id])
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@map("offers")
}

model Conversation {
  id        String    @id @default(uuid())
  user1     String
  user2     String
  messages  Message[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@unique([user1, user2])
  @@map("conversations")
}

model Message {
  id             String       @id @default(uuid())
  conversationId String
  sender         String
  content        String
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  user           User         @relation(fields: [sender], references: [id])
  createdAt      DateTime     @default(now())

  @@map("messages")
}
